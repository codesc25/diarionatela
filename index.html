<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diário de Classe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        .history-item:hover {
            background-color: #f3f4f6;
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-6">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-6">Diário de Classe</h1>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Formulário -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <form id="diario-form" class="space-y-4">
                    <div>
                        <label for="data" class="block text-sm font-medium text-gray-700 mb-1">Data:</label>
                        <input type="date" id="data" name="data" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="professor" class="block text-sm font-medium text-gray-700 mb-1">Professor:</label>
                        <input type="text" id="professor" name="professor" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="disciplina" class="block text-sm font-medium text-gray-700 mb-1">Disciplina:</label>
                        <input type="text" id="disciplina" name="disciplina" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="turma" class="block text-sm font-medium text-gray-700 mb-1">Turma:</label>
                        <select id="turma" name="turma" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="6ºM1">6ºM1</option>
                            <option value="7ºM1">7ºM1</option>
                            <option value="8ºM1">8ºM1</option>
                            <option value="9ºM1">9ºM1</option>
                            <option value="6ºV1">6ºV1</option>
                            <option value="7ºV1">7ºV1</option>
                            <option value="8ºV1">8ºV1</option>
                            <option value="EJA">EJA</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="cargaHoraria" class="block text-sm font-medium text-gray-700 mb-1">Carga Horária:</label>
                        <input type="number" id="cargaHoraria" name="cargaHoraria" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <div>
                        <label for="conteudo" class="block text-sm font-medium text-gray-700 mb-1">Conteúdo:</label>
                        <textarea id="conteudo" name="conteudo" rows="4" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div>
                        <label for="observacoes" class="block text-sm font-medium text-gray-700 mb-1">Observações:</label>
                        <textarea id="observacoes" name="observacoes" rows="4"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>
                    
                    <div class="flex flex-wrap gap-3 pt-2">
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                            Salvar
                        </button>
                        <button type="button" id="export-pdf" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors">
                            Exportar para PDF
                        </button>
                        <button type="button" id="clear-data" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors">
                            Limpar Dados
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Dados Salvos e Histórico -->
            <div class="bg-white rounded-lg shadow-md p-6 space-y-6">
                <div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Registro Atual</h3>
                    <div id="saved-data" class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Campo</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Valor</th>
                                </tr>
                            </thead>
                            <tbody id="saved-data-body" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="2" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Nenhum dado salvo ainda</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">Histórico</h3>
                    <div id="history-list" class="overflow-y-auto max-h-96">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Data</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Disciplina</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Turma</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="history-list-body" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="4" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Nenhum registro no histórico</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('diario-form');
            const exportPdfBtn = document.getElementById('export-pdf');
            const clearDataBtn = document.getElementById('clear-data');
            const savedDataBody = document.getElementById('saved-data-body');
            const historyListBody = document.getElementById('history-list-body');
            
            const localStorageKey = 'diarioDeClasseData';
            const localStorageHistoryKey = 'diarioDeClasseHistory';

            // Carregar dados do localStorage
            loadData();
            loadHistory();

            form.addEventListener('submit', function(event) {
                event.preventDefault();
                saveData();
            });

            exportPdfBtn.addEventListener('click', function() {
                exportToPdf();
            });

            clearDataBtn.addEventListener('click', function() {
                clearData();
            });

            function saveData() {
                const formData = {
                    id: Date.now(),
                    data: document.getElementById('data').value,
                    professor: document.getElementById('professor').value,
                    disciplina: document.getElementById('disciplina').value,
                    turma: document.getElementById('turma').value,
                    cargaHoraria: document.getElementById('cargaHoraria').value,
                    conteudo: document.getElementById('conteudo').value,
                    observacoes: document.getElementById('observacoes').value || 'Nenhuma',
                    timestamp: new Date().toISOString()
                };
                
                // Salvar dados atuais
                localStorage.setItem(localStorageKey, JSON.stringify(formData));
                
                // Adicionar ao histórico
                const history = JSON.parse(localStorage.getItem(localStorageHistoryKey)) || [];
                history.unshift(formData);
                localStorage.setItem(localStorageHistoryKey, JSON.stringify(history));
                
                displaySavedData(formData);
                displayHistory(history);
                
                alert('Dados salvos com sucesso!');
            }

            function loadData() {
                const savedData = localStorage.getItem(localStorageKey);
                if (savedData) {
                    const formData = JSON.parse(savedData);
                    document.getElementById('data').value = formData.data;
                    document.getElementById('professor').value = formData.professor;
                    document.getElementById('disciplina').value = formData.disciplina;
                    document.getElementById('turma').value = formData.turma;
                    document.getElementById('cargaHoraria').value = formData.cargaHoraria;
                    document.getElementById('conteudo').value = formData.conteudo;
                    document.getElementById('observacoes').value = formData.observacoes === 'Nenhuma' ? '' : formData.observacoes;
                    displaySavedData(formData);
                }
            }

            function loadHistory() {
                const history = JSON.parse(localStorage.getItem(localStorageHistoryKey)) || [];
                displayHistory(history);
            }

            function displaySavedData(data) {
                if (!data) {
                    savedDataBody.innerHTML = `
                        <tr>
                            <td colspan="2" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Nenhum dado salvo ainda</td>
                        </tr>
                    `;
                    return;
                }
                
                savedDataBody.innerHTML = `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Data</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(data.data)}</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Professor</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${data.professor}</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Disciplina</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${data.disciplina}</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Turma</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${data.turma}</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Carga Horária</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${data.cargaHoraria}</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Conteúdo</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${data.conteudo}</td>
                    </tr>
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">Observações</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${data.observacoes}</td>
                    </tr>
                `;
            }

            function displayHistory(history) {
                if (history.length === 0) {
                    historyListBody.innerHTML = `
                        <tr>
                            <td colspan="4" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">Nenhum registro no histórico</td>
                        </tr>
                    `;
                    return;
                }
                
                historyListBody.innerHTML = history.map(item => `
                    <tr class="history-item">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(item.data)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.disciplina}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.turma}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button onclick="loadHistoryItem(${item.id})" class="text-blue-600 hover:text-blue-900 mr-3">Carregar</button>
                            <button onclick="deleteHistoryItem(${item.id})" class="text-red-600 hover:text-red-900">Excluir</button>
                        </td>
                    </tr>
                `).join('');
            }

            function formatDate(dateString) {
                if (!dateString) return '';
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR');
            }

            function exportToPdf() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Título
                doc.setFontSize(18);
                doc.setTextColor(40, 40, 40);
                doc.setFont('helvetica', 'bold');
                doc.text('Diário de Classe', 14, 20);
                
                // Data de emissão
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.setFont('helvetica', 'normal');
                doc.text(`Emitido em: ${new Date().toLocaleDateString('pt-BR')}`, 14, 28);
                
                // Dados do registro atual
                const savedData = JSON.parse(localStorage.getItem(localStorageKey));
                
                if (!savedData) {
                    alert('Nenhum dado encontrado para exportar!');
                    return;
                }
                
                // Configuração da tabela
                const columns = [
                    {header: 'Campo', dataKey: 'campo'},
                    {header: 'Valor', dataKey: 'valor'}
                ];
                
                const rows = [
                    {campo: 'Data', valor: formatDate(savedData.data)},
                    {campo: 'Professor', valor: savedData.professor},
                    {campo: 'Disciplina', valor: savedData.disciplina},
                    {campo: 'Turma', valor: savedData.turma},
                    {campo: 'Carga Horária', valor: savedData.cargaHoraria},
                    {campo: 'Conteúdo', valor: savedData.conteudo},
                    {campo: 'Observações', valor: savedData.observacoes}
                ];
                
                // Adiciona a tabela
                doc.autoTable({
                    columns: columns,
                    body: rows,
                    startY: 35,
                    margin: {horizontal: 14},
                    styles: {
                        fontSize: 10,
                        cellPadding: 4,
                        overflow: 'linebreak',
                        valign: 'middle'
                    },
                    headerStyles: {
                        fillColor: [41, 128, 185],
                        textColor: 255,
                        fontStyle: 'bold'
                    },
                    alternateRowStyles: {
                        fillColor: [245, 245, 245]
                    },
                    columnStyles: {
                        campo: {
                            fontStyle: 'bold',
                            cellWidth: 50
                        },
                        valor: {
                            cellWidth: 'auto'
                        }
                    }
                });
                
                // Salva o PDF
                doc.save(`diario-classe-${formatDate(savedData.data).replace(/\//g, '-')}.pdf`);
            }

            function clearData() {
                if (confirm('Tem certeza que deseja limpar todos os dados salvos?')) {
                    localStorage.removeItem(localStorageKey);
                    localStorage.removeItem(localStorageHistoryKey);
                    form.reset();
                    displaySavedData(null);
                    displayHistory([]);
                    alert('Todos os dados foram removidos!');
                }
            }

            // Função global para carregar item do histórico
            window.loadHistoryItem = function(id) {
                const history = JSON.parse(localStorage.getItem(localStorageHistoryKey)) || [];
                const item = history.find(i => i.id === id);
                if (item) {
                    document.getElementById('data').value = item.data;
                    document.getElementById('professor').value = item.professor;
                    document.getElementById('disciplina').value = item.disciplina;
                    document.getElementById('turma').value = item.turma;
                    document.getElementById('cargaHoraria').value = item.cargaHoraria;
                    document.getElementById('conteudo').value = item.conteudo;
                    document.getElementById('observacoes').value = item.observacoes === 'Nenhuma' ? '' : item.observacoes;
                    
                    // Atualiza os dados atuais
                    localStorage.setItem(localStorageKey, JSON.stringify(item));
                    displaySavedData(item);
                    
                    // Rola para o topo do formulário
                    document.querySelector('form').scrollIntoView({ behavior: 'smooth' });
                }
            };

            // Função global para excluir item do histórico
            window.deleteHistoryItem = function(id) {
                if (confirm('Tem certeza que deseja excluir este registro do histórico?')) {
                    let history = JSON.parse(localStorage.getItem(localStorageHistoryKey)) || [];
                    history = history.filter(item => item.id !== id);
                    localStorage.setItem(localStorageHistoryKey, JSON.stringify(history));
                    displayHistory(history);
                    
                    // Verifica se o item excluído era o registro atual
                    const currentData = JSON.parse(localStorage.getItem(localStorageKey));
                    if (currentData && currentData.id === id) {
                        localStorage.removeItem(localStorageKey);
                        form.reset();
                        displaySavedData(null);
                    }
                }
            };
        });
    </script>
</body>
</html>
